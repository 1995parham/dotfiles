# vim: set ft=tmux:
# Tmux keybindings configuration

# set primary prefix to C-Space and secondary to C-b
set -g prefix C-Space
set -g prefix2 C-b
bind-key C-a send-keys C-b

# quick key for moving back to the previous window
bind-key L last-window

# vim style bindings for pane movement
bind-key -r h select-pane -L
bind-key -r j select-pane -D
bind-key -r k select-pane -U
bind-key -r l select-pane -R

# disable arrow key bindings to prevent accidental pane switching
unbind-key Up
unbind-key Down
unbind-key Left
unbind-key Right

# split windows in current path, create new window in home
bind-key v split-window -h -c "#{pane_current_path}"
bind-key s split-window -v -c "#{pane_current_path}"
bind-key c new-window -c "$HOME"

# interactive session/window tree browser
bind-key . choose-tree -Zs

# kill session and window with confirmation
bind-key X confirm-before kill-session
bind-key x confirm-before kill-window

# pipe pane content to file
bind-key C-p pipe-pane 'cat >>~/Downloads/output.#I-#P'

# open emacs org-mode agenda in popup
bind-key A display-popup -E -w 80% -h 60% emacs -nw --eval '(org-agenda nil "n")'

# open project and layout selectors in popups
bind-key P display-popup -E -w 80% -h 70% ~/.config/tmuxs/new.sh
bind-key C display-popup -E -w 80% -h 70% ~/.config/tmuxs/tmuxp.sh

# vim-style visual selection and copy in copy mode
bind-key -T copy-mode-vi v send-key -X begin-selection
bind-key -T copy-mode-vi y send-key -X copy-selection

# navigate between windows (repeatable)
bind-key -r p select-window -t :-
bind-key -r n select-window -t :+

# shell prompt navigation (tmux 3.4+ with OSC 133 support)
bind-key -r [ previous-prompt
bind-key -r ] next-prompt

# scroll to top/bottom (tmux 3.4+)
bind-key Home scroll-top
bind-key End scroll-bottom

# disable default Space layout cycling
unbind-key Space

# reload tmux configuration
bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "TMUX configuration was reloaded based on ~/.config/tmux/tmux.conf"

# clear pane history
bind-key C-k clear-history

# resize panes
bind-key < resize-pane -L 5
bind-key > resize-pane -R 5
bind-key + resize-pane -U 5
bind-key - resize-pane -D 5

# layout shortcuts
bind-key = select-layout even-vertical
bind-key | select-layout even-horizontal
bind-key V select-layout main-vertical
bind-key H select-layout main-horizontal

# mirrored layout shortcuts (tmux 3.5+)
bind-key M-V select-layout main-vertical-mirrored
bind-key M-H select-layout main-horizontal-mirrored

# pass mouse scroll events to applications (e.g., vim/neovim) when in alternate screen
bind-key -n WheelUpPane if-shell -F "#{alternate_on}" \
  "if-shell -F \"#{mouse_any_flag}\" \
    \"send-key -M\" \
    \"send-key -N 3 Up\"" \
  "copy-mode -e ; send-key -M"
bind-key -n WheelDownPane if-shell -F "#{alternate_on}" \
  "if-shell -F \"#{mouse_any_flag}\" \
    \"send-key -M\" \
    \"send-key -N 3 Down\"" \
  "if-shell -F \"#{pane_in_mode}\" \
    \"send-key -M\""