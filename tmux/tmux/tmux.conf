# vim: set ft=tmux:
# Main tmux configuration file
# Split into multiple files for better organization

# ============================================
# Core Settings
# ============================================

# update environment variables on attach
set-option -g update-environment "KITTY_LISTEN_ON KITTY_WINDOW_ID WEZTERM_PANE WEZTERM_UNIX_SOCKET"

# ensure terminal starts with 256 color support and true color
set -s default-terminal tmux-256color
set -as terminal-features ',*-256color:RGB'

# enhanced features for kitty/wezterm
set -as terminal-features ',xterm-kitty:RGB'
set -as terminal-features ',wezterm:RGB'

# enable OSC 52 clipboard for SSH sessions
set -g set-clipboard on

# enable extended keys for better modifier support (tmux 3.5+)
set -g extended-keys on

# switch to most recently active session when detaching (can be overridden per platform)
set-option -g detach-on-destroy on

# use vi-style key bindings in command mode and copy mode
set-option -g status-keys vi
setw -g mode-keys vi

# enable focus events for better vim/neovim integration
set-option -g focus-events on

# reduce escape time delay for better vim/neovim experience
set -sg escape-time 0

# prevent automatic window renaming based on running process
set-option -g allow-rename off

# allow applications to set pane titles (can be set to 'off' for stricter control)
set-option -g allow-set-title on

# use basename of current path for automatic window naming
set-option -g automatic-rename-format "#{b:pane_current_path}"

# start window indexing at 0
set -g base-index 0

# increase scrollback buffer size
set -g history-limit 50000

# automatically renumber windows when one is closed
set-option -g renumber-windows on

# enable mouse support
set -g mouse on

# set default width for main pane in main-horizontal/main-vertical layouts
setw -g main-pane-width 100

# constrain window size to smallest client viewing it
set-window-option -g window-size smallest

# ============================================
# Performance Settings
# ============================================

# update status bar every 30 seconds instead of default 15 (reduces CPU usage)
set -g status-interval 30

# display messages for 2 seconds
set -g display-time 2000

# display pane numbers for 3 seconds (prefix + q)
set -g display-panes-time 3000

# repeat time for repeatable commands (default is 500ms)
set -g repeat-time 600

# ============================================
# Security and UI Settings (tmux 3.4+)
# ============================================

# control where messages and prompts appear (0=bottom, 1/2/3=status line number)
set-option -g message-line 0

# allow escape sequence passthrough (on/off/all) - 'on' is balanced default
set-option -g allow-passthrough on

# ============================================
# Source configuration files
# ============================================

# Load keybindings
source-file ~/.config/tmux/keybindings.conf

# Load status bar configuration
source-file ~/.config/tmux/status-bar.conf

# Load color scheme
source-file ~/.config/tmux/colors.conf

# Load platform-specific configuration
if-shell 'uname | grep -q Darwin' {
  source-file ~/.config/tmux/platform-macos.conf
} {
  if-shell '[ "$SSH_CONNECTION" ]' {
    source-file ~/.config/tmux/platform-linux.conf
  }
}
